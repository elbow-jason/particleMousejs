<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
     
    <script type="text/javascript" src="./particle.js"></script>
    <script type="text/javascript" src="./flare.js"></script>
    <script type="text/javascript" src="./particleMath.js"></script>
    <script type="text/javascript" src="./particleWorld.js"></script>
    <script type="text/javascript" src="./canvasIO.js"></script>
  </head>
  <body>
    <canvas id="a" width="800" height="600" class="clear" 
        style="border:1px dotted;float:left"></canvas>
    <div>
    <button type="button" id="clear-canvas">Clear Canvas</button>
    </div>
    <div>
      <script>
      //document.addEventListener('DOMContentLoaded', function () {
        //<script type="text/javascript" src="./d3/d3.js"><script>
        //BurstEmitter e = new BurstEmitter(new Vec2d((1280 * 0.25),
        // (720 / 2.0)), 1000.0, 360.0, 0.0, 25.0, 100000.0, world); 
        
        //TriggerEmitter e = new TriggerEmitter(new Vec2d(1280 * 0.25, 720 / 2)
        //, 10000, 90, 0.5, 25.0, 10000, world); 
        //world.emitters.add(e); 
        var canvasevent       = new Event('runonce');
        var canvas            = document.getElementById('a');
        var canvasClearButton = document.getElementById('clear-canvas');
        var world             = new ParticleWorld(100, new Vector((800 / 2), (600 / 2))); 
        var time              = Date.now(); 
        var delta             = 0; 
        var canvasIO          = new CanvasIO(canvas);


        var tick = function(){
          canvas.dispatchEvent(canvasevent);
        };

        var delay             = 8;
        var intervalID = window.setInterval(tick, delay);




        
        world.newFlare(new Vector((800 * 0.25), (600 / 2)), 100, 90, 0, 10, 100000); 

        var update = function(dt){ 
          world.update(dt); 
        };

        var updateXY = function(mousePos){
          world.center.x = mousePos.x;
          world.center.y = mousePos.y;
        };

        canvasClearButton.addEventListener('click', function(evt){
          canvasIO.clearParticles();
          world.destroyEverything();
          });

        canvas.addEventListener('mousemove', function(evt) {
          var mousePos = canvasIO.getMousePos(evt);
          var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
          canvasIO.writeMessage(message);
          canvasIO.drawMousePos(mousePos);
          updateXY(mousePos);
        }, false);


        canvas.addEventListener('runonce', function(evt){
          canvasIO.writeTime();
          update(delta); 
          canvasIO.renderParticles(world); 
          delta = Date.now() - time; 
          time = Date.now(); 
      }, false);
  //});
      </script>
      </div>
  </body>
</html>